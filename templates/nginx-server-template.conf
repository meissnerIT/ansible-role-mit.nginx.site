# Managed by ansible (mit.nginx.site)
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

server {
    listen 80;
    server_name {{ site }};
    root /dev/null;
    access_log /srv/www/{{ site }}/logs/access.log;
    error_log  /srv/www/{{ site }}/logs/error.log;

{% if nginx_include_acmesh|default(true) %}    include conf.d/mit-acmesh.include;

{% endif %}
    location / {
        return 301 https://{{ site }}$request_uri;
    }
}

server {
    listen 443 ssl http2;
    server_name {{ site }};
    root /srv/www/{{ site }}/htdocs;
    access_log /srv/www/{{ site }}/logs/access.log;
    error_log  /srv/www/{{ site }}/logs/error.log;

    include conf.d/{{ nginx_ssl_include|default('ssl-'+site) }};

{% if nginx_include_other|default(false) %}    include conf.d/server-{{ site }}.include;

{% endif %}
    set $fpm_fastcgi_pass '127.0.0.1:{{ php_fpm_port|default('9999') }}';
{% if nginx_include_auth_basic|default(false) %}    location / {
        satisfy any;

        allow 10.10.10.180;
        deny  all;

        auth_basic "{{ site }}";
        auth_basic_user_file conf.d/server-{{ site }}.htpasswd;

        # enable execution of php scripts within this location
        include conf.d/{{ nginx_php_include|default('local-mit-php.include') }};
    }
{% endif %}
    include conf.d/{{ nginx_php_include|default('local-mit-php.include') }};
}

