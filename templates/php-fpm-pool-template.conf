; # Managed by ansible (mit.nginx.site)
; # DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

[{{ site }}]

user = {{ group }}
group = {{ group }}

listen = 127.0.0.1:{{ php_fpm_port }}

listen.owner = www-data
listen.group = www-data

pm = dynamic
{% if php_fpm_directives is not defined or (php_fpm_directives is defined and php_fpm_directives['pm.max_children'] is not defined) %}
pm.max_children = 20
{% endif %}
pm.min_spare_servers = 1
pm.max_spare_servers = 3
pm.start_servers = 2
pm.status_path = /php-fpm-status-20396

chdir = /

; # 2017-11-03, mm: Still 1 with php 7.0.19-1 / Debian 9
php_admin_value[cgi.fix_pathinfo] = 0

{% if php_fpm_upload_limit is defined %}
; Don't forget to set client_max_body_size in nginx configuration
php_admin_value[post_max_size] = {{ php_fpm_upload_limit | default("8M") }}
php_admin_value[upload_max_filesize] = {{ php_fpm_upload_limit | default("8M") }}
php_admin_value[upload_tmp_dir] = /srv/www/{{ site }}/tmp/php

{% endif %}
{% if php_fpm_directives is defined %}
{% for directive, value in php_fpm_directives.items() -%}
{% if value is mapping %}
{% for key, value2 in value.items() %}
{{ directive }}[{{ key }}] = {{ value2 }}
{% endfor %}
{% else %}
{{ directive }} = {{ value }}
{% endif %}
{%- endfor %}
{% endif %}

